<div class="yuv-audit" [ngClass]="{singleEntry: auditsRes?.items?.length === 1, onPage: auditsRes?.page > 1}"
  [yuvBusyOverlay]="busy">

  <div class="error" *ngIf="error">
    <div translate>yuv.framework.audit.fetch.error</div>
  </div>

  <ng-container *ngIf="auditsRes">

    <!-- query / filter form -->


    <form (ngSubmit)="query()" [formGroup]="searchForm" class="search" *ngIf="searchPanelShow"
      (yuvOutsideClick)="closeSearchPanel()">
      <h3 translate>yuv.framework.audit.search.title</h3>
      <div class="controls">
        <!-- TODO: enable once range queries are supported-->
        <!-- <p-calendar formControlName="dateRange" hideOnDateTimeSelect="true" showTime="true" selectionMode="range">
        </p-calendar> -->

        <!-- TODO: enable once there is a way to search for a creators title string -->
        <!-- <div class="form-control">
          <yuv-form-input [skipToggle]="true" [label]="'yuv.framework.audit.search.creator' | translate">
            <yuv-string formControlName="createdBy"></yuv-string>
          </yuv-form-input>
        </div> -->

        <div class="form-control">
          <yuv-form-input class="checkbox" [skipToggle]="true" [label]="auditLabels[c]" *ngFor="let c of searchActions">
            <yuv-checkbox [formControlName]="c"></yuv-checkbox>
          </yuv-form-input>
        </div>
      </div>
      <div class="buttons">
        <button type="button" (click)="closeSearchPanel()" translate>yuv.framework.audit.search.button.close</button>
        <button class="primary" type="submit" translate>yuv.framework.audit.search.button.submit</button>
      </div>
    </form>

    <!-- list of audits -->
    <div class="audits" *ngIf="auditsRes.items.length; else tplEmpty">
      <div class="audit-entry" *ngFor="let a of auditsRes.items"
        [ngClass]="{versionEnabled: ((a.action >= 300 && a.action < 400) || a.action === 201)}">
        <div class="created">
          <div class="date">{{a.creationDate | localeDate: 'eoShortDate'}}</div>
          <div class="time meta">{{a.creationDate | localeDate: 'eoShortTime'}}</div>
        </div>
        <div class="timeline"></div>
        <div class="content">
          <div class="entry">
            <div class="title">
              <span>{{auditLabels['a' + a.action]}}</span>
              <span class="version" title="{{'yuv.framework.audit.version'|translate}}">{{a.version}}</span>
            </div>
            <div class="creator meta">
              {{a.createdBy.title}}
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #tplEmpty>
      <div class="empty" translate>yuv.framework.audit.result.empty</div>
    </ng-template>

    <!-- controls -->
    <div class="footer">

      <button class="btn-search" [ngClass]="{badge: filtered}" (click)="openSearchPanel()">
        <yuv-icon [svg]="icon.search"></yuv-icon>
      </button>


      <div class="paging" *ngIf="auditsRes.hasMoreItems || auditsRes.page > 1">
        <button [disabled]="auditsRes.page === 1" (click)="goToPage(auditsRes.page - 1)">
          <yuv-icon class="prev" [svg]="icon.arrowNext"></yuv-icon>
        </button>
        {{auditsRes.page}}
        <button [disabled]="!auditsRes.hasMoreItems" (click)="goToPage(auditsRes.page + 1)">
          <yuv-icon class="next" [svg]="icon.arrowNext"></yuv-icon>
        </button>
      </div>
    </div>
  </ng-container>
</div>