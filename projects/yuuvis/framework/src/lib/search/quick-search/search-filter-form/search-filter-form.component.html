<ng-content></ng-content>
<form class="extras" #extrasForm [formGroup]="searchFieldsForm" *ngIf="formFields.length">
  <!-- <div class="columns" cdkDropList (cdkDropListDropped)="drop($event)" [cdkDropListData]="formFields">
    <ng-container *ngTemplateOutlet="group; context: { $implicit: filterGroup}"></ng-container>
  </div> -->

  <ng-container *ngTemplateOutlet="tmplNode; context: { node: filterGroup }"></ng-container>

  <!-- <div cdkDropList [cdkDropListData]="nodes" [id]="'main'" [cdkDropListConnectedTo]="dropTargetIds"
    (cdkDropListDropped)="drop($event)" [cdkDropListSortingDisabled]="true">

    <div *ngFor="let node of filterGroup.group" cdkDrag [cdkDragData]="node.id" (cdkDragMoved)="dragMoved($event)">

      <ng-container *ngTemplateOutlet="tmplNode,context:{node:node}"></ng-container>

    </div>
  </div> -->

  <!-- <div class="condition" *ngFor="let key of searchFieldsForm?.controls | keys">
    <div class="fe-chip">
      <yuv-object-form-element [situation]="'SEARCH'" [inlineError]="true" [element]="searchFieldsForm.controls[key]">
      </yuv-object-form-element>
      <button *ngIf="!disabled" type="button" (click)="removeFieldEntry(key)">
        <yuv-icon [icon]="'clear'"></yuv-icon>
      </button>
    </div>
    <div class="operator">&</div>
  </div> -->
</form>
<ng-template #group let-fg>
  <div class="group" cdkDrag *ngFor="let item of fg.group">
    <div class="condition" *ngIf="!item.group; innerGroup">
      <div class="fe-chip">
        <yuv-object-form-element [situation]="'SEARCH'" [inlineError]="true" [element]="searchFieldsForm.controls['fc_' + item.property]">
        </yuv-object-form-element>
      </div>
      <yuv-icon *ngIf="!disabled" class="remove" [icon]="'clear'" (click)="removeFieldEntry('fc_' + item.property)"> </yuv-icon>
    </div>
    <ng-container #innerGroup>
      <ng-container *ngTemplateOutlet="group; context: { $implicit: item }"></ng-container>
    </ng-container>
  </div>
  <div class="handle" cdkDragHandle class="operator"><yuv-icon [icon]="'dragHandle'"></yuv-icon> {{ fg.operator }}</div>
</ng-template>

<ng-template #tmplNode let-node="node">
  <div class="node-item" [attr.data-id]="node.id" [attr.id]="'node-' + node.id">
    <div
      *ngIf="node.group && node.group.length"
      class="node-group"
      cdkDropList
      [cdkDropListData]="node.group"
      [id]="node.id"
      [cdkDropListConnectedTo]="dropTargetIds"
      (cdkDropListDropped)="drop($event)"
      [cdkDropListSortingDisabled]="true"
    >
      <div *ngFor="let child of node.group || []" cdkDrag [cdkDragData]="child.id" (cdkDragMoved)="dragMovedSubject.next($event)">
        <ng-container *ngTemplateOutlet="tmplNode; context: { node: child }"></ng-container>
      </div>
    </div>
    <div class="handle" cdkDragHandle class="operator" (click)="node.operator = node.operator === 'OR' ? 'AND' : 'OR'">
      <yuv-icon [icon]="'dragHandle'"></yuv-icon> {{ node.property }} {{ node.operator }}
    </div>
  </div>
  <div class="condition" *ngIf="!node.group">
    <div class="fe-chip">
      <yuv-object-form-element [situation]="'SEARCH'" [inlineError]="true" [element]="searchFieldsForm.controls['fc_' + node.property]">
      </yuv-object-form-element>
    </div>
    <yuv-icon *ngIf="!disabled" class="remove" [icon]="'clear'" (click)="removeFieldEntry('fc_' + node.property)"> </yuv-icon>
  </div>
</ng-template>
